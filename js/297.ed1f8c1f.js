"use strict";(self["webpackChunkmall_mogujie"]=self["webpackChunkmall_mogujie"]||[]).push([[297],{8641:function(t,e,s){s.d(e,{Z:function(){return c}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nav-bar"},[e("div",{staticClass:"left"},[t._t("left")],2),e("div",{staticClass:"center"},[t._t("center")],2),e("div",{staticClass:"right"},[t._t("right")],2)])},r=[],i={name:"NavBar"},n=i,l=s(3736),a=(0,l.Z)(n,o,r,!1,null,"3a4c01c3",null),c=a.exports},4765:function(t,e,s){s.r(e),s.d(e,{default:function(){return V}});var o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"home"}},[e("nav-bar",{staticClass:"home-nav-bar"},[e("div",{attrs:{slot:"center"},slot:"center"},[t._v("蘑菇街")])]),e("tab-control",{directives:[{name:"show",rawName:"v-show",value:t.tabControlShow,expression:"tabControlShow"}],ref:"tabControlfixed",staticClass:"home-tab-control",staticStyle:{"padding-top":"20px",position:"fixed",width:"100vw"},attrs:{titles:t.titles},on:{"tab-item-click":t.tabControlClick}}),e("v-scroll",{ref:"myscroller",attrs:{refresh:t.refresh,infinite:t.infinite,"set-style":t.vscrollStyle},on:{"y-change":t.yChange}},[e("home-swiper",{attrs:{banners:t.banners}}),e("home-recommend",{attrs:{"item-list":t.recommends}}),e("home-feature"),e("tab-control",{ref:"tabControl",staticClass:"home-tab-control",attrs:{titles:t.titles},on:{"tab-item-click":t.tabControlClick}}),e("goods-list",{ref:"goodsList",attrs:{"goods-list":t.showGoods}})],1),e("back-top",{directives:[{name:"show",rawName:"v-show",value:t.backTopShow,expression:"backTopShow"}],nativeOn:{click:function(e){return t.clickBackTop.apply(null,arguments)}}})],1)},r=[],i=(s(7658),s(7707));function n(){return(0,i.d)({method:"GET",url:"/home/multidata"})}function l(t,e){return(0,i.d)({method:"GET",url:"/home/data",params:{type:t,page:e}})}var a=s(8641),c=function(){var t=this,e=t._self._c;return e("div",[e("swiper",{staticClass:"swiper",attrs:{options:t.swiperOption},on:{swiper:t.onSwiper,slideChange:t.onSlideChange}},[t._l(t.banners,(function(t,s){return e("swiper-slide",{key:s},[e("img",{staticClass:"banner",attrs:{src:t.image}})])})),e("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"})],2)],1)},h=[],p=s(551),f={name:"HomeSwiper",props:{banners:{type:Array,default(){return[]}}},components:{Swiper:p.Swiper,SwiperSlide:p.SwiperSlide},data(){return{swiperOption:{pagination:{el:".swiper-pagination",clickable:!0},autoplay:{delay:3e3},loop:!0}}},methods:{onSwiper(){},onSlideChange(){}}},d=f,u=s(3736),m=(0,u.Z)(d,c,h,!1,null,"462b38cc",null),g=m.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-recommend"},t._l(t.itemList,(function(s){return e("div",{key:s.title,staticClass:"box"},[e("a",{attrs:{href:s.link}},[e("img",{attrs:{src:s.image,alt:""}})]),e("p",[t._v(t._s(s.title))])])})),0)},y=[],b={name:"HomeRecommend",props:{itemList:{type:Array}}},C=b,w=(0,u.Z)(C,v,y,!1,null,"03e90194",null),x=w.exports,T=function(){var t=this;t._self._c;return t._m(0)},_=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-feature"},[e("img",{attrs:{src:s(8775),alt:""}})])}],S={name:"HomeFeature",mounted(){},methods:{}},$=S,k=(0,u.Z)($,T,_,!1,null,"8050b814",null),H=k.exports,L=function(){var t=this,e=t._self._c;return e("scroller",{ref:"vscroller",style:t.setStyle,attrs:{refreshLayerColor:t.refreshLayerColor,refreshText:t.refreshText,noDataText:t.noDataText,"on-refresh":t.refresh,"on-infinite":t.infinite}},[t._t("default")],2)},I=[],G={name:"VScroll",props:{setStyle:{type:String,default:"padding-top: 0"},refresh:{type:Function,default:function(t){t()}},infinite:{type:Function,default:function(t){t()}},refreshText:{type:String,default:"下拉刷新"},refreshLayerColor:{type:String,default:"#AAA"},noDataText:{type:String,default:"没有更多数据了"}},data(){return{x:0,y:0,posListener:null}},updated(){this.posListener=setInterval((()=>{if(this.$refs.vscroller&&this.$refs.vscroller.getPosition){let{left:t,top:e}=this.$refs.vscroller.getPosition();this.x=t,this.y=e}}),200)},watch:{y(){this.$emit("y-change",this.y)},x(){this.$emit("x-change",this.x)}},beforeDestroy(){this.posListener=null},methods:{scrollTo(t,e,s=!0){this.$refs.vscroller.scrollTo(t,e,s)},scrollBy(t,e,s=!0){this.$refs.vscroller.scrollBy(t,e,s)},finishInfinite(t=!1){this.$refs.vscroller.finishInfinite(t)},resize(){this.$refs.vscroller.resize()},getPosition(){return this.$refs.vscroller.getPosition()}}},B=G,Z=(0,u.Z)(B,L,I,!1,null,"1ca9b79a",null),D=Z.exports,A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"tab-control"},t._l(t.titles,(function(s,o){return e("div",{key:s,staticClass:"box"},[e("div",{staticClass:"item",class:{active:o===t.currentIndex},on:{click:function(e){return t.itemClick(o)}}},[t._v(t._s(s))])])})),0)},O=[],Y={name:"TabControl",data(){return{currentIndex:0}},methods:{itemClick(t){this.currentIndex=t,this.$emit("tab-item-click",t)}},props:{titles:{type:Array,default(){return[]}}}},E=Y,F=(0,u.Z)(E,A,O,!1,null,"1827643b",null),P=F.exports,R=s(4570),j=s(145),z={name:"Home",components:{NavBar:a.Z,HomeSwiper:g,HomeRecommend:x,HomeFeature:H,TabControl:P,GoodsList:R.Z,VScroll:D},mixins:[j.s6],data(){return{banners:[],recommends:[],titles:["流行","新款","精选"],gType:"pop",goods:{pop:{page:0,list:[]},new:{page:0,list:[]},sell:{page:0,list:[]}},tabOffsetTop:0,tabControlShow:!1,vscrollStyle:"padding-top: 44px;height: 100vh;",posY:null,tmpY:0}},updated(){},created(){this.getHomeMultidata(),this.getHomeGoods("new"),this.getHomeGoods("sell")},activated(){this.$nextTick((()=>{this.$refs.myscroller.resize(),this.$refs.myscroller.scrollTo(0,this.posY,!1),this.$refs.myscroller.resize()}))},deactivated(){let{left:t,top:e}=this.$refs.myscroller.getPosition();this.posY=parseInt(e)},mounted(){let t=this;window.onmousewheel=function(e){let s=t.$refs.myscroller;e.wheelDelta<0?s&&s.scrollBy(0,30,!1):s&&s.scrollBy(0,-30,!1)}},computed:{showGoods(){return this.goods[this.gType].list}},methods:{yChange(t){this.tmpY=parseInt(t),this.positionMove(this.tmpY)},positionMove(t){let e=this.$refs.goodsList.$el.offsetTop,s=this.$refs.tabControl.$el.offsetTop;this.judgeBackTopShow(t-500,e),this.tabControlShow=s<=t+60},getHomeMultidata(){n().then((t=>{this.banners=t.data.banner.list,this.recommends=t.data.recommend.list}))},getHomeGoods(t){let e=this.goods[t].page+1;return l(t,e).then((s=>(this.goods[t].page=e,this.goods[t].list.push(...s.data.list),s.data.list)))},tabControlClick(t){this.gType=["pop","new","sell"][t],this.$refs.tabControlfixed.currentIndex=t,this.$refs.tabControl.currentIndex=t},initData(){this.goods={pop:{page:0,list:[]},new:{page:0,list:[]},sell:{page:0,list:[]}},this.getHomeGoods("pop"),this.getHomeGoods("new"),this.getHomeGoods("sell")},refresh(t){setTimeout((()=>{this.initData(),t()}),1e3)},infinite(t){setTimeout((()=>{this.getHomeGoods(this.gType).then((e=>{e.length>0?this.$refs.myscroller.$refs.vscroller.finishInfinite(!1):this.$refs.myscroller.$refs.vscroller.finishInfinite(!0),t()}))}),500)},clickBackTop(){this.scrollBackTop((()=>{this.$refs.myscroller.scrollTo(0,0,!0),setTimeout((()=>{this.$refs.myscroller.scrollTo(0,0)}),10),this.tabControlShow=!1}))},setOffsetTop(){this.tabOffsetTop=this.$refs.tabControl&&this.$refs.tabControl.$el.offsetTop}}},M=z,N=(0,u.Z)(M,o,r,!1,null,"761f146e",null),V=N.exports},8301:function(t,e,s){s.d(e,{Vn:function(){return r},ax:function(){return o},vi:function(){return i}});const o="goods-imgs-load",r="detail-imgs-load",i="DETAIL_BSCROLL_REFRESH"},8775:function(t,e,s){t.exports=s.p+"img/recommend_bg.a1646d5d.jpg"}}]);
//# sourceMappingURL=297.ed1f8c1f.js.map